package seedu.kolinux.timetable;

import org.junit.jupiter.api.AfterEach;
import org.junit.jupiter.api.BeforeAll;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import seedu.kolinux.exceptions.KolinuxException;
import seedu.kolinux.module.ModuleDb;
import seedu.kolinux.module.ModuleList;
import seedu.kolinux.timetable.subcommand.AddSubCommand;

import java.io.ByteArrayOutputStream;
import java.io.PrintStream;

import static org.junit.jupiter.api.Assertions.assertEquals;

public class TimetableViewTest {


    private static final String EMPTY_TIMETABLE = "+-------------+--------------------+--------------------"
            +
            "+--------------------+--------------------+--------------------+\n"
            +
            "|             |       MONDAY       |       TUESDAY      |      WEDNESDAY     |      THURSDAY      "
            +
            "|       FRIDAY       |\n+-------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+--------------------+\n"
            +
            "|0600 - 0700  |                    |                    |                    |                    "
            +
            "|                    |\n+-------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+--------------------+\n"
            +
            "|0700 - 0800  |                    |                    |                    "
            +
            "|                    |                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+\n"
            +
            "|0800 - 0900  |                    |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+\n"
            +
            "|0900 - 1000  |                    |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+\n"
            +
            "|1000 - 1100  |                    |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+\n"
            +
            "|1100 - 1200  |                    |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+\n"
            +
            "|1200 - 1300  |                    |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+\n"
            +
            "|1300 - 1400  |                    |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+\n"
            +
            "|1400 - 1500  |                    |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+\n"
            +
            "|1500 - 1600  |                    |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+\n"
            +
            "|1600 - 1700  |                    |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+\n"
            +
            "|1700 - 1800  |                    |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+\n"
            +
            "|1800 - 1900  |                    |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+\n"
            +
            "|1900 - 2000  |                    |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+\n"
            +
            "|2000 - 2100  |                    |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+";
    private static final String ONE_LESSON_IN_TIMETABLE = "+-------------+--------------------+--------------------"
            +
            "+--------------------+--------------------+--------------------+\n"
            +
            "|             |       MONDAY       |       TUESDAY      |      WEDNESDAY     |      THURSDAY      "
            +
            "|       FRIDAY       |\n+-------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+--------------------+\n"
            +
            "|0600 - 0700  |     CS1231 TUT     |                    |                    |                    "
            +
            "|                    |\n+-------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+--------------------+\n"
            +
            "|0700 - 0800  |                    |                    |                    "
            +
            "|                    |                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+\n"
            +
            "|0800 - 0900  |                    |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+\n"
            +
            "|0900 - 1000  |                    |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+\n"
            +
            "|1000 - 1100  |                    |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+\n"
            +
            "|1100 - 1200  |                    |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+\n"
            +
            "|1200 - 1300  |                    |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+\n"
            +
            "|1300 - 1400  |                    |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+\n"
            +
            "|1400 - 1500  |                    |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+\n"
            +
            "|1500 - 1600  |                    |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+\n"
            +
            "|1600 - 1700  |                    |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+\n"
            +
            "|1700 - 1800  |                    |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+\n"
            +
            "|1800 - 1900  |                    |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+\n"
            +
            "|1900 - 2000  |                    |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+\n"
            +
            "|2000 - 2100  |                    |                    |                    |                    "
            +
            "|                    |\n"
            +
            "+-------------+--------------------+--------------------+--------------------+--------------------"
            +
            "+--------------------+";

    private static final String[] VALID_ADD_TUTORIAL_ARGUMENTS = new String[] {"CS1231", "TUT", "monday",
            "0600", "0700"};
    private static final ModuleDb moduleDb = new ModuleDb();
    private ModuleList moduleList = new ModuleList();
    private Timetable timetable = new Timetable(moduleList);
    private AddSubCommand addSubCommand = new AddSubCommand();
    private final ByteArrayOutputStream output = new ByteArrayOutputStream();
    private final PrintStream standardOut = System.out;


    @BeforeAll
    public static void initModuleDb() {
        moduleDb.initModuleDb();
    }

    @BeforeEach
    public void clear() {
        moduleList.clear();
    }

    @BeforeEach
    public void setUp() {
        System.setOut(new PrintStream(output));
    }

    @AfterEach
    public void tearDown() {
        System.setOut(standardOut);
    }

    @Test
    void viewTimetable_noLessonInTimetable_emptyTimetablePrinted() {
        timetable.clearTimetable();
        timetable.executeView();
        String expectedString = EMPTY_TIMETABLE.replaceAll("\\n|\\r\\n", System.getProperty("line.separator"));
        assertEquals(EMPTY_TIMETABLE, output.toString().trim());
    }

    @Test
    void viewTimetable_oneLessonInTimetable_TimetablePrinted() throws KolinuxException {
        timetable.clearTimetable();
        moduleList.storeModuleByCode("CS1231", moduleDb);
        timetable.executeAdd(VALID_ADD_TUTORIAL_ARGUMENTS);
        timetable.executeView();
        String expectedString = ONE_LESSON_IN_TIMETABLE.replaceAll("\\n|\\r\\n",
                System.getProperty("line.separator"));
        assertEquals(ONE_LESSON_IN_TIMETABLE, output.toString().trim());
    }

}
